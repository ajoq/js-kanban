(()=>{"use strict";class t{static showError(t,e){const s=document.createElement("div");s.className="popover";const i=document.createElement("div");i.className="arrow";const o=document.createElement("div");o.className="popover-body",o.textContent=t,s.append(i),s.append(o),e.after(s),s.style.top=`${e.getBoundingClientRect().height+8}px`,s.style.left=e.getBoundingClientRect().width/2-s.getBoundingClientRect().width/2+"px",i.style.left=s.getBoundingClientRect().width/2-i.getBoundingClientRect().width+3+"px",s.classList.add("popover-visible")}static hideError(){const t=document.querySelector(".popover");t&&t.remove()}}class e{constructor(){this.clearVars()}clearVars(){this.draggedEl=null,this.draggedElCoords=null,this.ghostEl=null,this.ghostElEmpty=null,this.cursX=null,this.cursY=null,this.insertItem=null,this.insertPosition=null}emptyGhostElement(t){const e=document.elementFromPoint(t.clientX,t.clientY),s=e.closest(".column-items");if(e.closest(".column")&&s&&!e.closest(".column-item.empty"))return""===s.innerHTML?(s.append(this.ghostElEmpty),void(this.insertItem={column:s.dataset.id})):void(e.closest(".column-item")&&t.pageY!==e.getBoundingClientRect().top+e.getBoundingClientRect().height/2&&(t.pageY<e.getBoundingClientRect().top+e.getBoundingClientRect().height/2&&(e.closest(".column-item").before(this.ghostElEmpty),this.insertPosition="before"),t.pageY>e.getBoundingClientRect().top+e.getBoundingClientRect().height/2&&(e.closest(".column-item").after(this.ghostElEmpty),this.insertPosition="after"),this.insertItem={id:+e.closest(".column-item").dataset.id,column:s.dataset.id,position:this.insertPosition}))}ticketGrab(t,e){t.preventDefault(),e&&(this.draggedEl=e,this.draggedElCoords=this.draggedEl.getBoundingClientRect(),this.ghostEl=e.cloneNode(!0),this.ghostEl.classList.add("dragged"),this.ghostElEmpty=e.cloneNode(!1),this.ghostElEmpty.classList.add("empty"),this.ghostElEmpty.style.height=this.draggedElCoords.height-16+"px",this.ghostElEmpty.style.backgroundColor="#d5dbde",document.body.append(this.ghostEl),this.ghostEl.style.left=this.draggedElCoords.left-8+"px",this.ghostEl.style.top=this.draggedElCoords.top-8+"px",this.cursX=t.pageX-this.draggedElCoords.left+8,this.cursY=t.pageY-this.draggedElCoords.top+8,this.emptyGhostElement(t),e.remove())}ticketMove(t){t.preventDefault(),this.draggedEl&&(this.ghostEl.style.left=t.pageX-this.cursX+"px",this.ghostEl.style.top=t.pageY-this.cursY+"px",this.emptyGhostElement(t),t.target.classList.add("grabbing"))}ticketLeave(){return!!this.draggedEl&&(e.grabbingRemove(),this.ghostEl.remove(),this.clearVars(),!0)}ticketDrop(){if(!this.draggedEl)return!1;this.ghostEl.remove(),this.ghostElEmpty.remove();const t={draggedElDiv:this.draggedEl,insertItemObj:this.insertItem};return this.clearVars(),e.grabbingRemove(),t}static grabbingRemove(){const t=Array.from(document.querySelectorAll(".grabbing"));t&&t.forEach((t=>t.classList.remove("grabbing")))}}class s{constructor(t){this.ticketsArr=[],t&&(this.ticketsArr=t),this.ticketsMove=new e}init(){this.tasks=document.querySelector(".tasks"),this.columnItems=document.querySelectorAll(".column-items"),localStorage.getItem("cards")&&(this.ticketsArr=JSON.parse(localStorage.getItem("cards")));const t=this.ticketsArr.slice();this.lastTicketId=t.sort(((t,e)=>t.id-e.id)).at(-1).id,this.events(),this.updateList()}events(){this.tasks.addEventListener("pointerdown",(t=>this.clickEvents(t))),this.tasks.addEventListener("pointermove",(t=>this.ticketsMove.ticketMove(t))),this.tasks.addEventListener("pointerleave",(()=>{this.ticketsMove.ticketLeave()&&(this.ticketsMove.ticketLeave(),this.updateList())})),this.tasks.addEventListener("pointerup",(()=>{const t=this.ticketsMove.ticketDrop();t&&this.insertTicket(t)}))}clickEvents(t){return t.target.closest(".add-item")?(s.addAnotherTicketCancel(),void this.addAnotherTicket(t)):t.target.closest(".delete-btn")?(t.preventDefault(),void s.addAnotherTicketCancel()):void(t.target.closest(".ticket-form")||(t.target.closest(".column-item__delete")?this.deleteCard(t):t.target.closest(".column-item")&&(s.addAnotherTicketCancel(),this.ticketsMove.ticketGrab(t,t.target.closest(".column-item")))))}addAnotherTicket(e){const s=e.target.closest(".column").querySelector(".column-items"),i=document.createElement("form");i.classList.add("ticket-form"),i.name="ticketForm",i.noValidate=!0,i.innerHTML='\n            <textarea name="ticketFormValue" class="add-area" placeholder="Enter a text for this card" required></textarea>\n            <div class="buttons">\n                <button class="add-btn" type="submit">Add card</button>\n                <button class="delete-btn" type="reset">&#10005;</button>\n            </div>            \n        ',s.after(i),e.target.closest(".add-item").classList.add("hidden"),i.addEventListener("submit",(e=>{e.preventDefault(),""!==i.ticketFormValue.value.trim()?this.addCard(s.dataset.id,i.ticketFormValue.value):t.showError("The field cannot be empty",i.ticketFormValue)})),setTimeout((()=>i.ticketFormValue.focus()),10),i.ticketFormValue.addEventListener("focus",(()=>t.hideError())),i.ticketFormValue.addEventListener("keydown",(t=>{"Enter"===t.code&&(t.preventDefault(),document.querySelector(".add-btn").click())}))}static addAnotherTicketCancel(){const t=document.querySelector(".ticket-form");t&&(t.remove(),document.querySelector(".add-item.hidden").classList.remove("hidden"))}addCard(t,e){this.lastTicketId+=1,this.ticketsArr.push({id:this.lastTicketId,column:t,text:e}),s.addAnotherTicketCancel(),this.updateList()}deleteCard(t){const e=+t.target.closest(".column-item").dataset.id,s=this.ticketsArr.findIndex((t=>t.id===e));this.ticketsArr.splice(s,1),this.updateList()}insertTicket(t){const e=t.draggedElDiv,s=t.insertItemObj,i=this.ticketsArr.find((t=>t.id===+e.dataset.id));if(s.id===i.id)return void this.updateList();i.column=s.column;const o=this.ticketsArr.findIndex((t=>t.id===+e.dataset.id));if(this.ticketsArr.splice(o,1),s.id||s.position){const t=this.ticketsArr.findIndex((t=>t.id===+s.id));"before"===s.position&&this.ticketsArr.splice(t,0,i),"after"===s.position&&this.ticketsArr.splice(t+1,0,i)}else this.ticketsArr.push(i);this.updateList()}updateList(){Array.from(this.columnItems).forEach((t=>{t.innerHTML=""})),this.ticketsArr.forEach((t=>{const e=Array.from(this.columnItems).find((e=>t.column===e.dataset.id)),s=document.createElement("div");s.className="column-item",s.dataset.id=t.id,s.innerHTML=`\n                <div class="column-item__text">${t.text}</div>\n                <div class="column-item__delete"></div>           \n            `,e.append(s)})),localStorage.setItem("cards",JSON.stringify(this.ticketsArr))}}new s([{id:10,column:"todo",text:"Королевство применяет традиционный орогенез, именно здесь с 8.00 до 11.00 идет оживленная торговля с лодок, нагруженных всевозможными тропическими фруктами, овощами, орхидеями, банками с пивом"},{id:2,column:"todo",text:"Плейстоцен, как бы это ни казалось парадоксальным, деформирует тектонический протерозой"},{id:3,column:"todo",text:"Проникновение глубинных магм изменяет афтершок"},{id:4,column:"todo",text:"Иными словами, шток сдвигает биографический метод. Героическое, в первом приближении, продолжает языковой пингвин"},{id:5,column:"in-progress",text:"Акцентируется не красота садовой дорожки, а площадь последовательно сменяет малиньит, что в общем свидетельствует о преобладании тектонических опусканий в это время"},{id:6,column:"in-progress",text:"Искусство, куда входят Пик-Дистрикт, Сноудония и другие многочисленные национальные резерваты природы и парки, просветляет рейтинг"},{id:7,column:"done",text:"Отложение, в первом приближении, однородно просветляет городской сталактит"},{id:8,column:"done",text:"Селитра, как бы это ни казалось парадоксальным, оправдывает экспериментальный кимберлит, при этом имейте в виду, что чаевые следует оговаривать заранее, так как в разных заведениях они могут сильно различаться"},{id:1,column:"done",text:"Инвестиционный продукт, тем более в условиях социально-экономического кризиса, имеет тенденцию культурный рекламный клаттер"}]).init()})();